#!/bin/sh

# Exit on errors and undefined variables
set -eu

# Configuration variables for Minecraft server setup
export MINECRAFT_USER="minecraft"
export MINECRAFT_GROUP="minecraft"
export MINECRAFT_DIR="/var/minecraft_server"
export MINECRAFT_JAR="server.jar"
export SERVICE_SCRIPT="/usr/local/bin/minecraftctl"
export MONITOR_SCRIPT="/usr/local/bin/minecraftmon"
export RESTART_SCRIPT="/usr/local/bin/minecraftrst"
export PID_FILE="minecraft_server.pid"
export PID_PATH="${MINECRAFT_DIR}/${PID_FILE}"
export MEMORY_ALLOCATION="8G"
export TMUX_SOCKET_FILE="minecraft_socket"
export TMUX_SOCKET_DIR="/tmp/tmux-${MINECRAFT_USER}"
export TMUX_SOCKET_PATH="${TMUX_SOCKET_DIR}/${TMUX_SOCKET_FILE}"
export TMUX_SESSION="minecraft_session"

# BEGIN MINECRAFT INSTALLER AUTO-CONFIG
@SERVICE_LINE@
TMUX_PATH="@TMUX_PATH@"
JAVA_PATH="@JAVA_PATH@"
CHPST_PATH="@CHPST_PATH@"
@RESOURCE_LIMIT_LINE@
MINECRAFT_COMMAND="exec $JAVA_PATH -Xmx$MEMORY_ALLOCATION -Xms$MEMORY_ALLOCATION -XX:+UseShenandoahGC -XX:+UseNUMA -XX:+AlwaysPreTouch -XX:+UseStringDeduplication -XX:+OptimizeStringConcat -jar $MINECRAFT_JAR nogui"
@START_COMMAND_LINE@
# END MINECRAFT INSTALLER AUTO-CONFIG
